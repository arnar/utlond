<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">




	<title>frontpage</title>
	<link rel="stylesheet" href="test2_files/highlight.css" type="text/css" charset="utf-8">
</head><body>

	<p>This is the excerpt.</p>

	<hr>
	<p>This is <em>emphasis</em> and this is <strong>strong emphasis</strong>. We can also have <tt class="docutils literal"><span class="pre">inline</span> <span class="pre">literals</span></tt> and simple reference <a class="reference" href="http://www.mbl.is/">targets</a> as well as <a class="reference" href="http://www.google.com/">phrase references</a>. This creates a footnote <a class="footnote-reference" href="#id3" id="id1" name="id1">[1]</a> and citations <a class="citation-reference" href="#ab2008" id="id2" name="id2">[AB2008]</a> and this is simply a hyperlink: <a class="reference" href="http://www.hvergi.net/">http://www.hvergi.net/</a>.</p>
<table class="docutils footnote" id="id3" frame="void" rules="none">
<colgroup><col class="label"><col></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1" name="id3">[1]</a></td><td>This is the text of a footnote</td></tr>
</tbody>
</table>
<table class="docutils citation" id="ab2008" frame="void" rules="none">
<colgroup><col class="label"><col></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2" name="ab2008">[AB2008]</a></td><td>This is a citation.
Like used in scientific discussion.</td></tr>
</tbody>
</table>
<div class="section">
<h1><a id="here-is-a-title" name="here-is-a-title">Here is a title</a></h1>
<p>And some content here. Bla ble.</p>
<div class="section">
<h2><a id="and-a-subheading" name="and-a-subheading">And a subheading</a></h2>
<ul class="simple">
<li>We can have bullet lists.</li>
<li>Even with items that span
multiple lines</li>
</ul>
<ol class="arabic simple">
<li>Also an enumeration list.</li>
<li>Using a number sign creates automatic numbering.</li>
</ol>
<dl class="docutils">
<dt>word</dt>
<dd>Definition of word here</dd>
<dt>something else</dt>
<dd>The definition can be long and span a few lines,
continuation is determined by indentation.</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name">
<col class="field-body">
<tbody valign="top">
<tr class="field"><th class="field-name">Authors:</th><td class="field-body">Arnar Birgisson,
Nobody else</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">1.0</td>
</tr>
<tr class="field"><th class="field-name">Scheme:</th><td class="field-body">Light</td>
</tr>
</tbody>
</table>
<p>We can also have regular literal blocks:</p>
<pre class="literal-block">This is done by ending a line with two colons.
This can go on and on
For several lines
Just use indent
</pre>
<p>We can also use this format for indentation</p>
<p>&gt; Indent each line with a prefix,
&gt; like replies in an email.</p>
<div class="line-block">
<div class="line">Line blocks are useful for addresses,</div>
<div class="line">verse, and adornment-free lists.</div>
<div class="line"><br></div>
<div class="line">Each new line begins with a</div>
<div class="line">vertical bar ("|").</div>
<div class="line-block">
<div class="line">Line breaks and initial indents</div>
<div class="line">are preserved.</div>
</div>
<div class="line">Continuation lines are wrapped
portions of long lines; they begin
with spaces in place of vertical bars.</div>
</div>
<p>Block quotes are just</p>
<blockquote>
Indented paragraphs
that can also span several lines and have some <em>real</em> content.
Not like this one which contains just nonsense to fill up some lines in the browser</blockquote>
<p>Simple table:</p>
<table class="docutils" border="1">
<colgroup>
<col width="31%">
<col width="31%">
<col width="38%">
</colgroup>
<thead valign="bottom">
<tr><th class="head" colspan="2">Inputs</th>
<th class="head">Output</th>
</tr>
<tr><th class="head">A</th>
<th class="head">B</th>
<th class="head">A or B</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr><td>True</td>
<td>False</td>
<td>True</td>
</tr>
<tr><td>False</td>
<td>True</td>
<td>True</td>
</tr>
<tr><td>True</td>
<td>True</td>
<td>True</td>
</tr>
</tbody>
</table>
<p>And end this with a transition (hr)</p>
<hr class="docutils">
<p>Then for directives, we can include images like this:</p>
<img alt="/media/img/admin/icon_success.gif" src="test2_files/icon_success.gif">
<p>Sniðugt stöff.:</p>
<pre class="literal-block">class Cave(object):
    pass
</pre>
<table class="syntaxtable"><tbody><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="syntax"><pre><span class="c"># A very long line here that can march right off the right side of the page if it is to narrow, yes yes.</span>
<span class="k">class</span> <span class="nc">Cave</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
   <span class="k">pass</span>
</pre></div>
</td></tr></tbody></table><div class="syntax"><pre><span class="kr">module</span> <span class="nn">Sos</span> <span class="kr">where</span>
<span class="kr">import</span> <span class="nn">Ast</span>
<span class="kr">import</span> <span class="nn">State</span>
<span class="kr">import</span> <span class="nn">Eval</span>

<span class="kr">import</span> <span class="nn">Random</span>
<span class="kr">import</span> <span class="nn">Control.Monad</span>

<span class="nf">pick</span> <span class="ow">::</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="n">a</span>
<span class="nf">pick</span> <span class="n">l</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">r</span> <span class="ow">&lt;-</span> <span class="n">getStdRandom</span> <span class="p">(</span><span class="n">randomR</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">length</span> <span class="n">l</span><span class="p">))</span>
            <span class="n">return</span> <span class="o">$</span> <span class="n">l</span> <span class="o">!!</span> <span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="kr">data</span> <span class="kt">Action</span>
    <span class="ow">=</span> <span class="kt">Epsilon</span>
    <span class="o">|</span> <span class="kt">Output</span> <span class="kt">String</span> <span class="kt">Integer</span>
    <span class="o">|</span> <span class="kt">Input</span> <span class="kt">String</span> <span class="kt">String</span>

<span class="kr">data</span> <span class="kt">Config</span>
    <span class="ow">=</span> <span class="kt">Inter</span> <span class="kt">C</span> <span class="kt">State</span> <span class="kt">Action</span>
    <span class="o">|</span> <span class="kt">Final</span> <span class="kt">State</span> <span class="kt">Action</span>
    <span class="o">|</span> <span class="kt">FailedGC</span>

<span class="c1">--isFinal :: Config -&gt; Bool</span>
<span class="c1">--isFinal (Inter c s) = False</span>
<span class="c1">--isFinal (Final s) = True</span>

<span class="nf">mentions</span> <span class="ow">::</span> <span class="kt">Action</span> <span class="ow">-&gt;</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
<span class="nf">mentions</span> <span class="kt">Epsilon</span> <span class="n">c</span> <span class="ow">=</span> <span class="kt">False</span>
<span class="nf">mentions</span> <span class="p">(</span><span class="kt">Output</span> <span class="n">s</span> <span class="n">i</span><span class="p">)</span> <span class="n">c</span> <span class="ow">=</span> <span class="n">s</span> <span class="o">==</span> <span class="n">c</span>
<span class="nf">mentions</span> <span class="p">(</span><span class="kt">Input</span> <span class="n">s</span> <span class="n">v</span><span class="p">)</span> <span class="n">c</span> <span class="ow">=</span> <span class="n">s</span> <span class="o">==</span> <span class="n">c</span>

<span class="nf">derivSeq</span> <span class="ow">::</span> <span class="kt">Config</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="p">[</span><span class="kt">Config</span><span class="p">]</span>
<span class="nf">derivSeq</span> <span class="p">(</span><span class="kt">Inter</span> <span class="n">c</span> <span class="n">s</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="kt">Inter</span> <span class="n">c</span> <span class="n">s</span> <span class="n">a</span> <span class="kt">:</span><span class="p">)</span> <span class="p">`</span><span class="n">liftM</span><span class="p">`</span> <span class="p">(</span><span class="n">derivSeq</span> <span class="o">=&lt;&lt;</span> <span class="n">sosC</span> <span class="p">(</span><span class="kt">Inter</span> <span class="n">c</span> <span class="n">s</span> <span class="n">a</span><span class="p">))</span>
<span class="nf">derivSeq</span> <span class="p">(</span><span class="kt">Final</span>   <span class="n">s</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=</span> <span class="n">return</span> <span class="p">[</span><span class="kt">Final</span> <span class="n">s</span> <span class="n">a</span><span class="p">]</span>


<span class="nf">sosC</span> <span class="ow">::</span> <span class="kt">Config</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="kt">Config</span>

<span class="nf">sosC</span> <span class="p">(</span><span class="kt">Inter</span> <span class="kt">Nop</span> <span class="n">s</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=</span> <span class="n">return</span> <span class="p">(</span><span class="kt">Final</span> <span class="n">s</span> <span class="kt">Epsilon</span><span class="p">)</span>

<span class="nf">sosC</span> <span class="p">(</span><span class="kt">Inter</span> <span class="p">(</span><span class="kt">Assign</span> <span class="n">x</span> <span class="n">e</span><span class="p">)</span> <span class="n">s</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=</span>
    <span class="n">return</span> <span class="p">(</span><span class="kt">Final</span> <span class="p">(</span><span class="n">update</span> <span class="n">s</span> <span class="n">x</span> <span class="p">(</span><span class="n">evalA</span> <span class="n">e</span> <span class="n">s</span><span class="p">))</span> <span class="kt">Epsilon</span><span class="p">)</span>

<span class="nf">sosC</span> <span class="p">(</span><span class="kt">Inter</span> <span class="p">(</span><span class="kt">Compose</span> <span class="n">c1</span> <span class="n">c2</span><span class="p">)</span> <span class="n">s</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=</span>
    <span class="n">sosC</span> <span class="p">(</span><span class="kt">Inter</span> <span class="n">c1</span> <span class="n">s</span> <span class="n">a</span><span class="p">)</span> <span class="o">&gt;&gt;=</span> <span class="n">return</span> <span class="o">.</span> <span class="n">f</span>
    <span class="kr">where</span>
        <span class="n">f</span> <span class="p">(</span><span class="kt">Final</span> <span class="n">s'</span> <span class="n">a'</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">Inter</span> <span class="n">c2</span> <span class="n">s'</span> <span class="n">a'</span>
        <span class="n">f</span> <span class="p">(</span><span class="kt">Inter</span> <span class="n">c1'</span> <span class="n">s'</span> <span class="n">a'</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">Inter</span> <span class="p">(</span><span class="kt">Compose</span> <span class="n">c1'</span> <span class="n">c2</span><span class="p">)</span> <span class="n">s'</span> <span class="n">a'</span>

<span class="nf">sosC</span> <span class="p">(</span><span class="kt">Inter</span> <span class="p">(</span><span class="kt">If</span> <span class="n">gc</span><span class="p">)</span> <span class="n">s</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=</span>
    <span class="n">sosGC</span> <span class="n">gc</span> <span class="n">s</span> <span class="n">a</span> <span class="o">&gt;&gt;=</span> <span class="n">return</span> <span class="o">.</span> <span class="n">f</span>
    <span class="kr">where</span>
        <span class="n">f</span> <span class="p">(</span><span class="kt">Inter</span> <span class="n">c</span> <span class="n">s'</span> <span class="n">a'</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">Inter</span> <span class="n">c</span> <span class="n">s'</span> <span class="n">a'</span>

<span class="nf">sosC</span> <span class="p">(</span><span class="kt">Inter</span> <span class="p">(</span><span class="kt">Do</span> <span class="n">gc</span><span class="p">)</span> <span class="n">s</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=</span>
    <span class="n">sosGC</span> <span class="n">gc</span> <span class="n">s</span> <span class="n">a</span> <span class="o">&gt;&gt;=</span> <span class="n">return</span> <span class="o">.</span> <span class="n">f</span>
    <span class="kr">where</span>
        <span class="n">f</span> <span class="p">(</span><span class="kt">Inter</span> <span class="n">c</span> <span class="n">s'</span> <span class="n">a'</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">Inter</span> <span class="p">(</span><span class="kt">Compose</span> <span class="n">c</span> <span class="p">(</span><span class="kt">Do</span> <span class="n">gc</span><span class="p">))</span> <span class="n">s</span> <span class="n">a'</span>
        <span class="n">f</span> <span class="kt">FailedGC</span> <span class="ow">=</span> <span class="kt">Final</span> <span class="n">s</span> <span class="kt">Epsilon</span>

<span class="nf">sosC</span> <span class="p">(</span><span class="kt">Inter</span> <span class="p">(</span><span class="kt">Star</span> <span class="n">c</span><span class="p">)</span> <span class="n">s</span> <span class="n">a</span><span class="p">)</span>
    <span class="ow">=</span> <span class="n">pick</span> <span class="p">[</span>
        <span class="kt">Inter</span> <span class="p">(</span><span class="kt">Compose</span> <span class="n">c</span> <span class="p">(</span><span class="kt">Star</span> <span class="n">c</span><span class="p">))</span> <span class="n">s</span> <span class="n">a</span><span class="p">,</span>
        <span class="kt">Final</span> <span class="n">s</span> <span class="n">a</span>
    <span class="p">]</span>

<span class="nf">sosC</span> <span class="p">(</span><span class="kt">Inter</span> <span class="p">(</span><span class="kt">ChanCommand</span> <span class="p">(</span><span class="kt">Send</span> <span class="n">c</span> <span class="n">e</span><span class="p">))</span> <span class="n">s</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=</span>
    <span class="n">return</span> <span class="o">$</span> <span class="kt">Final</span> <span class="n">s</span> <span class="p">(</span><span class="kt">Output</span> <span class="n">c</span> <span class="p">(</span><span class="n">evalA</span> <span class="n">e</span> <span class="n">s</span><span class="p">))</span>

<span class="nf">sosC</span> <span class="p">(</span><span class="kt">Inter</span> <span class="p">(</span><span class="kt">ChanCommand</span> <span class="p">(</span><span class="kt">Receive</span> <span class="n">c</span> <span class="n">var</span><span class="p">))</span> <span class="n">s</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=</span>
    <span class="n">return</span> <span class="o">$</span> <span class="kt">Final</span> <span class="n">s</span> <span class="p">(</span><span class="kt">Input</span> <span class="n">c</span> <span class="n">var</span><span class="p">)</span>

<span class="nf">sosC</span> <span class="p">(</span><span class="kt">Inter</span> <span class="p">(</span><span class="kt">Par</span> <span class="n">c1</span> <span class="n">c2</span><span class="p">)</span> <span class="n">s</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=</span> <span class="kr">do</span>
    <span class="n">cfg1</span> <span class="ow">&lt;-</span> <span class="n">sosC</span> <span class="o">$</span> <span class="kt">Inter</span> <span class="n">c1</span> <span class="n">s</span> <span class="n">a</span>
    <span class="n">cfg2</span> <span class="ow">&lt;-</span> <span class="n">sosC</span> <span class="o">$</span> <span class="kt">Inter</span> <span class="n">c2</span> <span class="n">s</span> <span class="n">a</span>
    <span class="n">f</span> <span class="n">cfg1</span> <span class="n">cfg2</span>
    <span class="kr">where</span>
        <span class="n">f</span> <span class="p">(</span><span class="kt">Final</span> <span class="n">s1</span> <span class="p">(</span><span class="kt">Output</span> <span class="n">ch1</span> <span class="n">val</span><span class="p">))</span> <span class="p">(</span><span class="kt">Final</span> <span class="n">s2</span> <span class="p">(</span><span class="kt">Input</span> <span class="n">ch2</span> <span class="n">var</span><span class="p">))</span>
            <span class="o">|</span> <span class="n">ch1</span> <span class="o">==</span> <span class="n">ch2</span> <span class="ow">=</span> <span class="n">return</span> <span class="o">$</span> <span class="kt">Final</span> <span class="p">(</span><span class="n">update</span> <span class="n">s2</span> <span class="n">var</span> <span class="n">val</span><span class="p">)</span> <span class="kt">Epsilon</span>
            <span class="o">|</span> <span class="n">otherwise</span> <span class="ow">=</span> <span class="n">g</span>
        <span class="n">f</span> <span class="p">(</span><span class="kt">Final</span> <span class="n">s1</span> <span class="p">(</span><span class="kt">Input</span> <span class="n">ch1</span> <span class="n">var</span><span class="p">))</span> <span class="p">(</span><span class="kt">Final</span> <span class="n">s2</span> <span class="p">(</span><span class="kt">Output</span> <span class="n">ch2</span> <span class="n">val</span><span class="p">))</span>
            <span class="o">|</span> <span class="n">ch1</span> <span class="o">==</span> <span class="n">ch2</span> <span class="ow">=</span> <span class="n">return</span> <span class="o">$</span> <span class="kt">Final</span> <span class="p">(</span><span class="n">update</span> <span class="n">s1</span> <span class="n">var</span> <span class="n">val</span><span class="p">)</span> <span class="kt">Epsilon</span>
            <span class="o">|</span> <span class="n">otherwise</span> <span class="ow">=</span> <span class="n">g</span>
        <span class="n">f</span> <span class="p">(</span><span class="kt">Inter</span> <span class="n">c</span> <span class="n">s1</span> <span class="p">(</span><span class="kt">Output</span> <span class="n">ch1</span> <span class="n">val</span><span class="p">))</span> <span class="p">(</span><span class="kt">Final</span> <span class="n">s2</span> <span class="p">(</span><span class="kt">Input</span> <span class="n">ch2</span> <span class="n">var</span><span class="p">))</span>
            <span class="o">|</span> <span class="n">ch1</span> <span class="o">==</span> <span class="n">ch2</span> <span class="ow">=</span> <span class="n">return</span> <span class="o">$</span> <span class="kt">Inter</span> <span class="n">c</span> <span class="p">(</span><span class="n">update</span> <span class="n">s2</span> <span class="n">var</span> <span class="n">val</span><span class="p">)</span> <span class="kt">Epsilon</span>
            <span class="o">|</span> <span class="n">otherwise</span> <span class="ow">=</span> <span class="n">g</span>
        <span class="n">f</span> <span class="p">(</span><span class="kt">Inter</span> <span class="n">c</span> <span class="n">s1</span> <span class="p">(</span><span class="kt">Input</span> <span class="n">ch1</span> <span class="n">var</span><span class="p">))</span> <span class="p">(</span><span class="kt">Final</span> <span class="n">s2</span> <span class="p">(</span><span class="kt">Output</span> <span class="n">ch2</span> <span class="n">val</span><span class="p">))</span>
            <span class="o">|</span> <span class="n">ch1</span> <span class="o">==</span> <span class="n">ch2</span> <span class="ow">=</span> <span class="n">return</span> <span class="o">$</span> <span class="kt">Inter</span> <span class="n">c</span> <span class="p">(</span><span class="n">update</span> <span class="n">s1</span> <span class="n">var</span> <span class="n">val</span><span class="p">)</span> <span class="kt">Epsilon</span>
            <span class="o">|</span> <span class="n">otherwise</span> <span class="ow">=</span> <span class="n">g</span>
        <span class="n">f</span> <span class="p">(</span><span class="kt">Final</span> <span class="n">s1</span> <span class="p">(</span><span class="kt">Output</span> <span class="n">ch1</span> <span class="n">val</span><span class="p">))</span> <span class="p">(</span><span class="kt">Inter</span> <span class="n">c</span> <span class="n">s2</span> <span class="p">(</span><span class="kt">Input</span> <span class="n">ch2</span> <span class="n">var</span><span class="p">))</span>
            <span class="o">|</span> <span class="n">ch1</span> <span class="o">==</span> <span class="n">ch2</span> <span class="ow">=</span> <span class="n">return</span> <span class="o">$</span> <span class="kt">Inter</span> <span class="n">c</span> <span class="p">(</span><span class="n">update</span> <span class="n">s2</span> <span class="n">var</span> <span class="n">val</span><span class="p">)</span> <span class="kt">Epsilon</span>
            <span class="o">|</span> <span class="n">otherwise</span> <span class="ow">=</span> <span class="n">g</span>
        <span class="n">f</span> <span class="p">(</span><span class="kt">Final</span> <span class="n">s1</span> <span class="p">(</span><span class="kt">Input</span> <span class="n">ch1</span> <span class="n">var</span><span class="p">))</span> <span class="p">(</span><span class="kt">Inter</span> <span class="n">c</span> <span class="n">s2</span> <span class="p">(</span><span class="kt">Output</span> <span class="n">ch2</span> <span class="n">val</span><span class="p">))</span>
            <span class="o">|</span> <span class="n">ch1</span> <span class="o">==</span> <span class="n">ch2</span> <span class="ow">=</span> <span class="n">return</span> <span class="o">$</span> <span class="kt">Inter</span> <span class="n">c</span> <span class="p">(</span><span class="n">update</span> <span class="n">s1</span> <span class="n">var</span> <span class="n">val</span><span class="p">)</span> <span class="kt">Epsilon</span>
            <span class="o">|</span> <span class="n">otherwise</span> <span class="ow">=</span> <span class="n">g</span>
        <span class="n">f</span> <span class="p">(</span><span class="kt">Inter</span> <span class="n">c1'</span> <span class="n">s1</span> <span class="p">(</span><span class="kt">Output</span> <span class="n">ch1</span> <span class="n">val</span><span class="p">))</span> <span class="p">(</span><span class="kt">Inter</span> <span class="n">c2'</span> <span class="n">s2</span> <span class="p">(</span><span class="kt">Input</span> <span class="n">ch2</span> <span class="n">var</span><span class="p">))</span>
            <span class="o">|</span> <span class="n">ch1</span> <span class="o">==</span> <span class="n">ch2</span> <span class="ow">=</span> <span class="n">return</span> <span class="o">$</span> <span class="kt">Inter</span> <span class="p">(</span><span class="kt">Par</span> <span class="n">c1'</span> <span class="n">c2'</span><span class="p">)</span> <span class="p">(</span><span class="n">update</span> <span class="n">s2</span> <span class="n">var</span> <span class="n">val</span><span class="p">)</span> <span class="kt">Epsilon</span>
            <span class="o">|</span> <span class="n">otherwise</span> <span class="ow">=</span> <span class="n">g</span>
        <span class="n">f</span> <span class="p">(</span><span class="kt">Inter</span> <span class="n">c1'</span> <span class="n">s1</span> <span class="p">(</span><span class="kt">Input</span> <span class="n">ch1</span> <span class="n">var</span><span class="p">))</span> <span class="p">(</span><span class="kt">Inter</span> <span class="n">c2'</span> <span class="n">s2</span> <span class="p">(</span><span class="kt">Output</span> <span class="n">ch2</span> <span class="n">val</span><span class="p">))</span>
            <span class="o">|</span> <span class="n">ch1</span> <span class="o">==</span> <span class="n">ch2</span> <span class="ow">=</span> <span class="n">return</span> <span class="o">$</span> <span class="kt">Inter</span> <span class="p">(</span><span class="kt">Par</span> <span class="n">c1'</span> <span class="n">c2'</span><span class="p">)</span> <span class="p">(</span><span class="n">update</span> <span class="n">s1</span> <span class="n">var</span> <span class="n">val</span><span class="p">)</span> <span class="kt">Epsilon</span>
            <span class="o">|</span> <span class="n">otherwise</span> <span class="ow">=</span> <span class="n">g</span>
        <span class="n">f</span> <span class="kr">_</span> <span class="kr">_</span> <span class="ow">=</span> <span class="n">g</span>
        <span class="n">g</span> <span class="ow">=</span> <span class="kr">do</span>
            <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">selectedC</span><span class="p">)</span> <span class="ow">&lt;-</span> <span class="n">pick</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="n">c1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">c2</span><span class="p">)]</span>
            <span class="n">cfg</span> <span class="ow">&lt;-</span> <span class="n">sosC</span> <span class="o">$</span> <span class="kt">Inter</span> <span class="n">selectedC</span> <span class="n">s</span> <span class="n">a</span>
            <span class="kr">case</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">cfg</span><span class="p">)</span> <span class="kr">of</span>
                <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kt">Final</span>   <span class="n">s</span> <span class="n">a</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">return</span> <span class="o">$</span> <span class="kt">Inter</span> <span class="n">c2</span> <span class="n">s</span> <span class="n">a</span>
                <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kt">Inter</span> <span class="n">c</span> <span class="n">s</span> <span class="n">a</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">return</span> <span class="o">$</span> <span class="kt">Inter</span> <span class="p">(</span><span class="kt">Par</span> <span class="n">c</span> <span class="n">c2</span><span class="p">)</span> <span class="n">s</span> <span class="n">a</span>
                <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kt">Final</span>   <span class="n">s</span> <span class="n">a</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">return</span> <span class="o">$</span> <span class="kt">Inter</span> <span class="n">c1</span> <span class="n">s</span> <span class="n">a</span>
                <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kt">Inter</span> <span class="n">c</span> <span class="n">s</span> <span class="n">a</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">return</span> <span class="o">$</span> <span class="kt">Inter</span> <span class="p">(</span><span class="kt">Par</span> <span class="n">c1</span> <span class="n">c</span><span class="p">)</span> <span class="n">s</span> <span class="n">a</span>

<span class="nf">sosC</span> <span class="p">(</span><span class="kt">Inter</span> <span class="p">(</span><span class="kt">Local</span> <span class="n">ch</span> <span class="n">c</span><span class="p">)</span> <span class="n">s</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=</span>
    <span class="n">f</span> <span class="o">=&lt;&lt;</span> <span class="p">(</span><span class="n">sosC</span> <span class="o">$</span> <span class="kt">Inter</span> <span class="n">c</span> <span class="n">s</span> <span class="n">a</span><span class="p">)</span>
    <span class="kr">where</span>
        <span class="n">f</span> <span class="p">(</span><span class="kt">Final</span> <span class="n">s</span> <span class="n">a</span><span class="p">)</span>
            <span class="o">|</span> <span class="n">not</span> <span class="p">(</span><span class="n">a</span> <span class="p">`</span><span class="n">mentions</span><span class="p">`</span> <span class="n">ch</span><span class="p">)</span> <span class="ow">=</span> <span class="n">return</span> <span class="o">$</span> <span class="kt">Final</span> <span class="n">s</span> <span class="n">a</span>
        <span class="n">f</span> <span class="p">(</span><span class="kt">Inter</span> <span class="n">c</span> <span class="n">s</span> <span class="n">a</span><span class="p">)</span>
            <span class="o">|</span> <span class="n">not</span> <span class="p">(</span><span class="n">a</span> <span class="p">`</span><span class="n">mentions</span><span class="p">`</span> <span class="n">ch</span><span class="p">)</span> <span class="ow">=</span> <span class="n">return</span> <span class="o">$</span> <span class="kt">Inter</span> <span class="p">(</span><span class="kt">Local</span> <span class="n">ch</span> <span class="n">c</span><span class="p">)</span> <span class="n">s</span> <span class="n">a</span>

<span class="nf">sosGC</span> <span class="ow">::</span> <span class="kt">GC</span> <span class="ow">-&gt;</span> <span class="kt">State</span> <span class="ow">-&gt;</span> <span class="kt">Action</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="kt">Config</span>

<span class="nf">sosGC</span> <span class="p">(</span><span class="kt">GuardedCommand</span> <span class="p">(</span><span class="kt">BoolGuard</span> <span class="n">b</span><span class="p">)</span> <span class="n">c</span><span class="p">)</span> <span class="n">s</span> <span class="n">a</span>
    <span class="o">|</span> <span class="n">evalB</span> <span class="n">b</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">return</span> <span class="o">$</span> <span class="kt">Inter</span> <span class="n">c</span> <span class="n">s</span> <span class="n">a</span>
    <span class="o">|</span> <span class="n">otherwise</span> <span class="ow">=</span> <span class="n">return</span> <span class="kt">FailedGC</span>

<span class="nf">sosGC</span> <span class="p">(</span><span class="kt">GuardedCommand</span> <span class="p">(</span><span class="kt">ChanGuard</span> <span class="p">(</span><span class="kt">Send</span> <span class="n">ch</span> <span class="n">e</span><span class="p">))</span> <span class="n">c</span><span class="p">)</span> <span class="n">s</span> <span class="n">a</span> <span class="ow">=</span>
    <span class="n">return</span> <span class="o">$</span> <span class="kt">Inter</span> <span class="n">c</span> <span class="n">s</span> <span class="p">(</span><span class="kt">Output</span> <span class="n">ch</span> <span class="p">(</span><span class="n">evalA</span> <span class="n">e</span> <span class="n">s</span><span class="p">))</span>

<span class="nf">sosGC</span> <span class="p">(</span><span class="kt">GuardedCommand</span> <span class="p">(</span><span class="kt">ChanGuard</span> <span class="p">(</span><span class="kt">Receive</span> <span class="n">ch</span> <span class="n">var</span><span class="p">))</span> <span class="n">c</span><span class="p">)</span> <span class="n">s</span> <span class="n">a</span> <span class="ow">=</span>
    <span class="n">return</span> <span class="o">$</span> <span class="kt">Inter</span> <span class="n">c</span> <span class="n">s</span> <span class="p">(</span><span class="kt">Input</span> <span class="n">ch</span> <span class="n">var</span><span class="p">)</span>

<span class="nf">sosGC</span> <span class="p">(</span><span class="kt">GuardedCommand</span> <span class="p">(</span><span class="kt">CompositeGuard</span> <span class="n">b</span> <span class="n">chop</span><span class="p">)</span> <span class="n">c</span><span class="p">)</span> <span class="n">s</span> <span class="n">a</span>
    <span class="o">|</span> <span class="n">evalB</span> <span class="n">b</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">sosGC</span> <span class="p">(</span><span class="kt">GuardedCommand</span> <span class="p">(</span><span class="kt">ChanGuard</span> <span class="n">chop</span><span class="p">)</span> <span class="n">c</span><span class="p">)</span> <span class="n">s</span> <span class="n">a</span>
    <span class="o">|</span> <span class="n">otherwise</span> <span class="ow">=</span> <span class="n">return</span> <span class="kt">FailedGC</span>

<span class="nf">sosGC</span> <span class="p">(</span><span class="kt">SelectGC</span> <span class="n">g1</span> <span class="n">g2</span><span class="p">)</span> <span class="n">s</span> <span class="n">a</span> <span class="ow">=</span>
    <span class="n">pickOrFail</span> <span class="o">.</span> <span class="n">filter</span> <span class="p">(</span><span class="n">not</span> <span class="o">.</span> <span class="n">fails</span><span class="p">)</span> <span class="o">=&lt;&lt;</span> <span class="n">mapM</span> <span class="p">(</span><span class="nf">\</span><span class="n">g</span> <span class="ow">-&gt;</span> <span class="n">sosGC</span> <span class="n">g</span> <span class="n">s</span> <span class="n">a</span><span class="p">)</span> <span class="n">gcList</span>
    <span class="kr">where</span>
        <span class="n">gcList</span> <span class="ow">=</span> <span class="n">flattenGC</span> <span class="p">(</span><span class="kt">SelectGC</span> <span class="n">g1</span> <span class="n">g2</span><span class="p">)</span>
        <span class="n">flattenGC</span> <span class="p">(</span><span class="kt">SelectGC</span> <span class="n">g1</span> <span class="n">g2</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">flattenGC</span> <span class="n">g1</span><span class="p">)</span> <span class="o">++</span> <span class="p">(</span><span class="n">flattenGC</span> <span class="n">g2</span><span class="p">)</span>
        <span class="n">flattenGC</span> <span class="n">a</span> <span class="ow">=</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>
        <span class="n">fails</span> <span class="kt">FailedGC</span> <span class="ow">=</span> <span class="kt">True</span>
        <span class="n">fails</span> <span class="kr">_</span> <span class="ow">=</span> <span class="kt">False</span>
        <span class="n">pickOrFail</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="n">return</span> <span class="kt">FailedGC</span>
        <span class="n">pickOrFail</span> <span class="n">l</span> <span class="ow">=</span> <span class="n">pick</span> <span class="n">l</span>
</pre></div>
</div>
</div>



</body></html>